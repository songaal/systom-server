<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="performance">

    <insert id="insertPerformanceSummary" parameterType="PerformanceSummary">
        INSERT INTO performance_summary
        (id, coin, base, cash, equity, sum_return, sum_return_pct, mdd, pnl_rate, avg_profit, avg_lose, trades, win_count, lose_count)
        VALUES( ${id}
              , ${coin}
              , ${base}
              , ${cash}
              , ${equity}
              , ${sumReturn}
              , ${sumReturnPct}
              , ${mdd}
              , ${pnlRate}
              , ${avgProfit}
              , ${avgLose}
              , ${trades}
              , ${winCount}
              , ${loseCount}
        )
    </insert>

    <delete id="deletePerformanceSummary" parameterType="Integer">
        DELETE FROM performance_summary
         WHERE id = #{param1}
    </delete>

    <delete id="deletePerformanceDaily" parameterType="Integer">
        DELETE FROM performance_daily
        WHERE id = #{param1}
    </delete>

    <select id="getPerformanceSummary" resultType="PerformanceSummary" parameterType="Integer">
        SELECT a.id
             , a.coin
             , a.base
             , a.cash
             , a.equity
             , a.sum_return
             , a.sum_return_pct
             , a.mdd
             , a.pnl_rate
             , a.avg_profit
             , a.avg_lose
             , a.trades
             , a.win_count
             , a.lose_count
             , a.commission
          FROM performance_summary a
         WHERE a.id = #{param1}
    </select>

    <select id="getPerformanceDailyList" resultType="PerformanceDaily" parameterType="Integer">
        SELECT a.id
             , a.date
             , a.market_price
             , a.cash
             , a.coin
             , a.base
             , a.equity
             , a.daily_return
             , a.daily_return_pct
             , a.cum_return
             , a.cum_return_pct
             , a.updated
          FROM performance_daily a
         WHERE a.id = #{param1}
    </select>

    <select id="retrievePerformanceDaily" resultType="PerformanceDaily" parameterType="Integer">
        SELECT a.id
             , a.updated
             , a.completed
          FROM performance_daily a
         WHERE ( a.completed is null
            OR a.updated > a.completed)
         ORDER BY updated
         LIMIT #{param1}
    </select>

    <!--SELECT a.id-->
    <!--, a.date-->
    <!--, a.market_price-->
    <!--, a.cash-->
    <!--, a.coin-->
    <!--, a.base-->
    <!--, a.equity-->
    <!--, a.daily_return-->
    <!--, a.daily_return_pct-->
    <!--, a.cum_return-->
    <!--, a.cum_return_pct-->
    <!--, a.updated-->
    <!--FROM performance_daily a-->
    <!--WHERE ( a.completed is null-->
    <!--OR a.updated > a.completed )-->


</mapper>
